<!DOCTYPE html>
<html lang="en" ng-app="myapp">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<link rel="stylesheet" href="css/reset.css">
	<link rel="stylesheet" href="css/swiper.min.css">
	<link rel="stylesheet" href="fonts/font.css">
	<!-- <link rel="stylesheet" href="css/bootstrap.min.css"> -->
	<link rel="stylesheet" href="css/default.css">
	<!-- <script src="js/faskclick.js"></script> -->
	<title>IN-Cake</title>
	<script src="js/resp.js"></script>
</head>
<body ng-controller="cont">

<div ng-view></div>

	<script src="js/jquery-1.11.2.min.js"></script>
	<script src="js/angular.min.js"></script>
	<script src="js/angular-route.js"></script>
	<script src="js/swiper.min.js"></script>
	<script src="js/fly.js"></script>
	<script> 
		var mySwiper = new Swiper('.swiper-container',{
			loop : true,
			slidesPerView : 1,
			pagination : '.swiper-pagination',
			loopedSlides :3,
			autoplay:2000,
		})
	</script>
	<script>
		//FastClick.attach(document.body);
		var app=angular.module("myapp",['ngRoute'],RouterConfig);
		function RouterConfig($routeProvider){
			$routeProvider
				.when("/",
					{templateUrl:"tml/index.html"
				})
				.when("/list",
					{templateUrl:"tml/list.html"
				})
				.when("/listmiss",
					{templateUrl:"tml/listmiss.html"}
				)
				.when("/shopcart",
					{templateUrl:"tml/shopcart.html"}
				)
				.otherwise({
					redirectTo:"/"
				})
		}
		app.controller('cont',function($scope,$interval){
			$scope.data=[
	       	   {"goodsId":"101010","img":"imgs/p2c10465173151557458.jpg","describe":"芝士女王","introduce":"Quee Cheese cake","price":"116","num":0,"mg":"1.5磅"},
               {"goodsId":"10fddsdf","img":"imgs/p2c135154428151557458.jpg","describe":"浓情巧克力","introduce":"Love in Chocolate","price":"116","num":0,"mg":"1.2磅"},
               {"goodsId":"123322","img":"imgs/p2c141338594151557458.jpg","describe":"云朵女孩","introduce":"Spotless Girl‘s cake","price":"116","num":0,"mg":"1.2磅"},
               {"goodsId":"2332846","img":"imgs/p2c151220539151557458.jpg","describe":"挚爱红丝绒","introduce":"Love Red Velvet","price":"116","num":0,"mg":"1.2磅"},
               {"goodsId":"3456","img":"imgs/p2c153423643151557458.jpg","describe":"抹茶丽兹","introduce":"Matcha Leeds","price":"116","num":0,"mg":"1.2磅"},
               {"goodsId":"992348","img":"imgs/p2c155833896151557458.jpg","describe":"无添加焦糖","introduce":"ugar-free Almond","price":"116","num":0,"mg":"1.2磅"},
               {"goodsId":"123131","img":"imgs/p2c16192425151557458.jpg","describe":"草莓物语","introduce":"Strawberry Tale","price":"116","num":0,"mg":"1.2磅"},
               {"goodsId":"3424221299","img":"imgs/p2c165757285151557458.jpg","describe":"经典奶昔","introduce":"Classic creme","price":"116","num":0,"mg":"1.2磅"} 
            ];
            $scope.miss=[
	       	   {"goodsId":"101011","img":"./imgs/p2c141958343151557458.jpg","describe":"经典小方","introduce":"Classic slices","price":"68","num":0,"mg":"4只装"},
               {"goodsId":"101012","img":"./imgs/p2c143029162151557458.jpg","describe":"芝士星语","introduce":"Queen Cheese","price":"99","num":0,"mg":"4只装"},
               {"goodsId":"101013","img":"./imgs/p2c16923177151557458.jpg","describe":"Happy Birthday黑巧克力","introduce":"Chocolae","price":"49","num":0,"mg":"1盒"},
               {"goodsId":"101014","img":"./imgs/p2c162426756151557458.jpg","describe":"Wedding黑巧克力","introduce":"Wedding Chocolae","price":"49","num":0,"mg":"1盒"},
               {"goodsId":"101015","img":"./imgs/p2c16420584151557458.jpg","describe":"Mother黑巧克力","introduce":"Mother Chocolate","price":"49","num":0,"mg":"1盒"},
               {"goodsId":"101016","img":"./imgs/p2c165354259151557458.jpg","describe":"Love黑巧克力","introduce":"Love Chocolate","price":"49","num":0,"mg":"1盒"},
               {"goodsId":"101017","img":"./imgs/p2c1755267151557458.jpg","describe":"Thank you黑巧克力","introduce":"Cholocate","price":"49","num":0,"mg":"1盒"},
               {"goodsId":"101018","img":"./imgs/p2c15422633151557458.jpg","describe":"以爱之名","introduce":"all about love","price":"69","num":0,"mg":"粉色"}           
			];
			$scope.cart=[
	       	  {"goodsId":"101021","img":"./imgs/number.jpg","describe":"数字蜡烛","introduce":"Classic slices","price":"2.00","num":0,"mg":"4只装"},
               {"goodsId":"101022","img":"./imgs/161-1.png","describe":"盘叉(5份)","introduce":"Queen Cheese","price":"2.50","num":0,"mg":"4只装"},
               {"goodsId":"101023","img":"./imgs/164-1.png","describe":"Happy Birthday","introduce":"Chocolae","price":"10.00","num":0,"mg":"1盒"},
               {"goodsId":"101024","img":"./imgs/p2c10549331151557458.jpg","describe":"I Love You","introduce":"Wedding Chocolae","price":"8.00","num":0,"mg":"1盒"},   
			];
			$scope.sumPrice=[];
			for(var i=0;i<$scope.data.length;i++){
				$scope.sumPrice.push($scope.data[i])
			}
			for(var i=0;i<$scope.miss.length;i++){
				$scope.sumPrice.push($scope.miss[i])
			}
			for(var i=0;i<$scope.cart.length;i++){
				$scope.sumPrice.push($scope.cart[i])
			}
			angular.forEach($scope.data,function(item,index){
            	item.num=0;
            	item.price=-(-(item.price));
            })
			// 点
			$scope.add=function(goodsId,bool,abb){
				//$scope.coun++;
				angular.forEach(abb,function(item,index){
					if(goodsId==item.goodsId){
            			if(bool){
							if(item.num==0){
								item.num=1;
								if($scope.data==abb||$scope.miss==abb){
									 $scope.butyData.push(item);
								}else if($scope.cart==abb){
									$scope.peijian.push(item)
								}
							}else{

								item.num++;
							}
            			}else{
        					item.num--;
        					
        					item.num=item.num<=0?0:item.num;	
            			}
            		}
				})
				//飞行的购物图片
			}
			$scope.butyData=[];
			//配件列表要遍历的空数组
			$scope.peijian=[];
			//监听已选蛋糕的数据变化
			
			$scope.$watch("data",function(){
            	angular.forEach($scope.butyData,function(item,index){
            		if(item.num<=0){
	            		$scope.butyData.splice(index,1);
            		}	
            	})
            },true);
			//监听已选蛋糕的数据变化
            $scope.$watch("miss",function(){
            	angular.forEach($scope.butyData,function(item,index){
            		if(item.num<=0){
	            		$scope.butyData.splice(index,1);
            		}
            	})
            },true);
            //监听已选配件的数据变化
            $scope.$watch("cart",function(){
            	angular.forEach($scope.peijian,function(item,index){
            		if(item.num<=0){
	            		$scope.peijian.splice(index,1);	
            		}
            	})
            },true);
            //监听所有已选商品的数据变化
  			$scope.$watch("sumPrice",function(){
         		$scope.allPrice=0;
         		$scope.coun=0;
            	angular.forEach($scope.sumPrice,function(item,index){
            		$scope.allPrice+=item.num*item.price;	
            		$scope.coun+=item.num;
            	})
            },true);


            $scope.flying=function(){
            	var flyer = $('<img class="u-flyer" src="this.item.img">');	
				flyer[0].src=this.item.img;
				flyer[0].style.width="80px";
				flyer[0].height="80";
				flyer[0].style.zIndex="9999";
	            //鼠标在页面点击开始位置计算.
				var top = $(window).scrollTop();			
				var dh = event.pageY;
				var newh = dh - top;
				// 购物车按钮  end在那图片飘到哪
				var oDiv = $('#end').offset();
				var newdh = oDiv.top - top;
				// 我可以设置初始,结束,图片宽度
				flyer.fly({
					start: {
						left: event.pageX,
						top: newh,
						// 初始的图片样式我可以设置在class类里面
					},
					end: {
						left: oDiv.left+10,
						top: newdh,
						width: 0,
						height: 0
					},
					onEnd:function(){
						this.destory();
					}
				});
            }
		});
	</script>
</body>
</html>